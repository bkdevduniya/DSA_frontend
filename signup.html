<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>signup</title>
    <link rel="stylesheet" href="./form.css">
</head>
<body>

    <div id="response-message">

    </div>

    <form action="http://localhost:5000/auth/signup" method="post" id="user-form">
        <label for="name">full name</label>
        <input id="name" type="text" placeholder="name" name="username" required><br>
        <label for="email">email</label>
        <input name="email" id="email" type="email" placeholder="email" required><br>
        <label for="password">password</label>
        <input id="password" name="password" type="password" placeholder="password" required><br>
        <label for="level">current level</label>
        <select id="level" name="level" required>
        <option value="beginner">beginner</option>
        <option value="intermediate">intermediate</option>
        <option value="expert">expert</option>
        </select>
        <button type="submit" id="signup">signup</button>
        <div id="another-option">Already have an account ? <a href="./login.html">login</a></div>
    </form>

    <script>
    
    function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i <ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}


    document.getElementById('user-form').addEventListener('submit', async function (e) {
    e.preventDefault(); // Prevent traditional form submission
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());
    
    try {
      const res = await fetch('http://localhost:5000/auth/signup', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
        credentials: 'include'
      });
      
      const result = await res.json(); // Assuming your server returns JSON
      console.log(result);
      // Show the response message on the page
      if(result.msg=="user already exist with this email"){
        let x=document.getElementById('response-message');
          x.style.visibility = 'visible';
          x.innerText = result.msg;
      }
      else if(result.msg=="user created"){
        console.log(getCookie('userToken'));
        let x=document.getElementById('response-message');
          x.style.visibility = 'visible';
          x.style.color = 'green';
          x.style.border = 'solid 1px green';
          x.style.boxShadow = '3px 3px 3px green, -3px -3px 3px green';
          x.innerText = result.msg;
          window.location.reload();
          window.location.href = '/';
      }
    } catch (err) {
      console.error('Error:', err);
    }
  });
</script>
</body>
</html>